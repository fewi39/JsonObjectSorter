<!DOCTYPE html>
<html>
  <head>
    <meta charset="uft-8">
    <title>jsonObjectSorter.html</title>
 
    <style>
      * { margin: 0; padding: 0; }
      .area { padding: 15% 15% 2rem; }
      .button-area { margin-bottom: 1rem; }
      .button-area > input[type=button] { width: 100%; padding: auto; }
      .process-area { display: flex; justify-content: space-between; margin-bottom: 1rem; }
      .process-area > div { display: inline-block; width: 30%; }
      .process-area > div > * { display: block; width: 100%; }
      .process-area textarea { height: 10rem; box-sizing: border-box; padding: 1rem; }
      .message-area > * { color: red; }
    </style>
  </head>

  <body>
    <div class="area">
      <div class="button-area">
        <input type="button" value="実行" onclick="doSort()" />
      </div>
      <div class="process-area">
        <div>
          <label>手本</label>
          <textarea id="model-text" class="text-area"></textarea>
        </div>
        <div>
          <label>入力データ</label>
          <textarea id="input-text" class="text-area"></textarea>
        </div>
        <div>
          <label>出力データ</label>
          <textarea id="output-text" class="text-area"></textarea>
        </div>
      </div>
      <div class="message-area">
        <p id="message"></p>
      </div>
    </div>

    <script>
      window.addEventListener("error", (event) => {
        const messageElement = document.getElementById("message")
        messageElement.textContent = event.message
      })

      // const logs = (arg1, arg2, arg3) => {
      //   console.log("model: "+JSON.stringify(arg1))
      //   console.log("input: "+JSON.stringify(arg2))
      //   console.log("output: "+JSON.stringify(arg3))
      // }

      const doSort = () => {
        const modelElement = document.getElementById("model-text")
        const inputElement = document.getElementById("input-text")
        const outputElement = document.getElementById("output-text")

        const modelValue = JSON.parse(modelElement.value)
        const inputValue = JSON.parse(inputElement.value)
        let outputValue = {}
        // logs(modelValue, inputValue, outputValue)

        sortJson(modelValue, inputValue, outputValue)
        if (Object.is(inputValue, outputValue) === false) {
          const inputString = JSON.stringify(inputValue)
          const outputString = JSON.stringify(outputValue)
          throw Error(`Sorted JSON is invalid. input=${inputString}, output=${outputString}.`)
        }
        outputElement.value = JSON.stringify(outputValue, null, "  ")
      }

      const sortJson = (modelJson, inputJson, outputJson) => {
        // logs(modelJson, inputJson, outputJson)

        Object.keys(modelJson).forEach((modelKey) => {
          if (inputJson.hasOwnProperty(modelKey)) {
            if (inputJson[modelKey].constructor === Object) {
              const childModelJson = modelJson[modelKey]
              const childInputJson = inputJson[modelKey]
              let chiledOutputJson = {}
              sortJson(childModelJson, childInputJson, chiledOutputJson)
              outputJson[modelKey] = chiledOutputJson
            } else {
              outputJson[modelKey] = inputJson[modelKey]
            }
            delete inputJson[modelKey]
            // logs(modelJson, inputJson, outputJson)
          }
        })

        Object.keys(inputJson).forEach((inputKey) => {
          outputJson[inputKey] = inputJson[inputKey]
          delete inputJson[inputKey]
          // logs(modelJson, inputJson, outputJson)
        })
      }

      const isEmptyJson = (json) => {
        return Object.keys(json).length === 0 && json.constructor === Object
      }
    </script>
  </body>
</html>
